{% extends 'base_template.html' %}
{% load static %}

{% block head_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .status-message {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
</style>
{% endblock %}

{% block top_nav %}
<!-- Status Messages -->
<div id="statusMessages" class="status-message"></div>
<!-- TOP NAV -->
<header class="fixed top-0 left-0 right-0 h-14 border-b bg-white flex items-center px-4 justify-between z-40">
    <div class="flex items-center gap-3">
        <button id="menuBtn" class="lg:hidden p-2 rounded-md hover:bg-gray-100">
            ☰
        </button>
        <h1 class="font-semibold text-lg">Product</h1>
    </div>

    <div class="flex items-center gap-4">
        <input type="text" placeholder="Search or type a command" class="hidden md:block w-64 px-4 py-1.5 rounded-md border text-sm focus:ring-1 focus:ring-gray-300" />
        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white">
            JD
        </div>
    </div>
</header>
{% endblock %}

{% block side_nav %}
<div class="p-4">
    <div class="text-xs uppercase text-gray-500">Main Menu</div>

    <nav class="mt-3 space-y-1 text-sm">
        <a href="" class="flex items-center px-3 py-2 rounded-md hover:bg-gray-100">
            <span class="mr-2"><i class="fas fa-home"></i></span> Home
        </a>

        <details class="group">
            <summary class="cursor-pointer flex items-center px-3 py-2 hover:bg-gray-200 rounded-md select-none">
                <span class="mr-2"><i class="fas fa-calculator"></i></span> Category <span class="ml-auto"><i class="fas fa-chevron-down"></i></span>
            </summary>
            <div class="pl-8 mt-1 space-y-2 text-gray-700">
                <a href="#" class="block hover:text-black">Category Settings</a>
            </div>
        </details>

        <details class="group">
            <summary class="cursor-pointer flex items-center px-3 py-2 hover:bg-gray-200 rounded-md select-none">
                <span class="mr-2"><i class="fas fa-users"></i></span> Product <span class="ml-auto"><i class="fas fa-chevron-down"></i></span>
            </summary>
            <div class="pl-8 mt-1 space-y-2 text-gray-700">
                <a href="#" class="block hover:text-black">Product Settings</a>
            </div>
        </details>
    </nav>
</div>
{% endblock %}

{% block main_content %}
<!-- Chart -->
<div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
    <h2 class="text-xl font-semibold mb-4">Sample Chart</h2>
    <canvas id="myChart" style="max-height: 350px;"></canvas>
</div>

<!-- Shortcuts -->
<h2 class="text-xl font-semibold">Your Shortcuts</h2>

<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-2 mt-3 text-sm">
    <a class="p-3 rounded-md border hover:bg-gray-50 flex justify-between" href="#">
        Employee <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">1 Active</span>
    </a>
    <a class="p-3 rounded-md border hover:bg-gray-50" href="#">Leave Application →</a>
    <a class="p-3 rounded-md border hover:bg-gray-50" href="#">HR Dashboard →</a>
    <a class="p-3 rounded-md border hover:bg-gray-50" href="#">Employee Lifecycle Dashboard →</a>
    <a class="p-3 rounded-md border hover:bg-gray-50" href="#">Attendance Dashboard →</a>
    <a class="p-3 rounded-md border hover:bg-gray-50" href="#">Recruitment Dashboard →</a>
</div>


<!-- Sample Table -->
<h2 class="text-xl font-semibold mt-8 mb-4">Sample Table</h2>
<div class="overflow-x-auto bg-white rounded-lg shadow-sm">
    <table class="min-w-full table-auto">
        <thead>
            <tr class="bg-gray-50">
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">

            <!-- Example for looping data recycle -->
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Alice Brown</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Marketing</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium relative">
                    <button class="text-gray-500 hover:text-gray-700 text-lg">⋮</button>
                    <div class="fixed w-32 bg-white border rounded shadow hidden z-50">
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Edit</a>
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Delete</a>
                    </div>
                </td>
            </tr>
            <!-- end loop -->

        </tbody>
    </table>
</div>


<!-- Reports & Masters -->
<h2 class="text-xl font-semibold mt-8">Reports & Masters</h2>

<div class="grid md:grid-cols-3 gap-6 mt-4 text-sm">

    <!-- Setup -->
    <div>
        <h3 class="font-medium text-gray-700 mb-2">Setup</h3>
        <ul class="space-y-1">
            <li><a href="#" class="hover:underline">Company →</a></li>
            <li><a href="#" class="hover:underline">Branch →</a></li>
            <li><a href="#" class="hover:underline">Department →</a></li>
            <li><a href="#" class="hover:underline">Designation →</a></li>
        </ul>
    </div>

    <!-- Employee -->
    <div>
        <h3 class="font-medium text-gray-700 mb-2">Employee</h3>
        <ul class="space-y-1">
            <li><a href="#" class="hover:underline">Employee →</a></li>
            <li><a href="#" class="hover:underline">Employee Grade →</a></li>
        </ul>
    </div>

    <!-- Leaves -->
    <div>
        <h3 class="font-medium text-gray-700 mb-2">Leaves</h3>
        <ul class="space-y-1">
            <li><a href="#" class="hover:underline">Leave Application →</a></li>
            <li><a href="#" class="hover:underline">Compensatory Leave Request →</a></li>
        </ul>
    </div>
</div>

<!-- Chart Script -->
<script>
    const ctx = document.getElementById('myChart').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Sample Points',
                data: [10, 20, 15, 25, 30, 22],
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                title: {
                    display: false
                }
            }
        }
    });

    // Table menu toggle
    function toggleMenu(event, button) {
        event.stopPropagation();
        const menu = button.nextElementSibling;
        if (menu.classList.contains('hidden')) {
            menu.style.left = event.clientX + 'px';
            menu.style.top = event.clientY + 'px';
            menu.classList.remove('hidden');
        } else {
            menu.classList.add('hidden');
        }
    }

    // Event delegation for table buttons
    const table = document.querySelector('table');
    table.addEventListener('click', function (e) {
        if (e.target.matches('button')) {
            toggleMenu(e, e.target);
        } else if (e.target.matches('a[data-action="delete"]')) {
            e.preventDefault();
            deleteRow(e.target);
        } else if (e.target.matches('a[data-action="edit"]')) {
            e.preventDefault();
            editRow(e.target);
        }
    });

    // Async delete function
    async function deleteRow(link) {
        const row = link.closest('tr');
        const name = row.cells[0].textContent.trim();
        if (confirm(`Delete ${name}?`)) {
            try {
                const response = await fetch('/api/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name })
                });
                if (response.ok) {
                    row.remove();
                    alert('Deleted successfully');
                } else {
                    alert('Delete failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting');
            }
        }
    }

    // Placeholder edit function
    function editRow(link) {
        const row = link.closest('tr');
        const name = row.cells[0].textContent.trim();
        alert(`Edit ${name} - functionality not implemented`);
    }

</script>
{% endblock %}